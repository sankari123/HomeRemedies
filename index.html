<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0"/>
<title><center><font face=verdana size=12>Home Remedies</font></center></title>
<script type="text/javascript" src="cordova.js"></script>



<!--<script language="JavaScript" type="text/javascript" src="events.js"></script>-->

<script type="text/JavaScript" language="JavaScript">


 

function alertDismissed() {
            alert('ddd');
        }	
function init() {
    	document.addEventListener("deviceready", onDeviceReady, false);
	
}


function onDeviceReady(){
	
	//checkConnection();
	ajaxFunction();
	document.addEventListener("backbutton", function (e) {
        e.preventDefault(); 
	navigator.notification.confirm("Do you want to exit MMF?", onConfirmExit, "Madras Music Fest", "Yes,No");    }, false );
}
function checkConnection() {
     var networkState = navigator.connection.type;
     if(navigator.connection.type == Connection.NONE) {        
        connSel='N';
	   //  alert(connSel);
	     
        window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, RgotFS, fail);
    }
   else
      {
	    connSel='Y';
	     // alert(connSel);
	 changedate('return');
	 
      }
	
}
	
function RgotFS(fileSystem) {
        fileSystem.root.getFile("events.txt", null, RgotFileEntry, fail);
    }	
	
	
function gotFS(fileSystem) {
        fileSystem.root.getFile("events.txt", {create: true, exclusive: false}, gotFileEntry, fail);
}

function RgotFileEntry(fileEntry) {
        fileEntry.file(gotFile, fail);
    }
	
	
function gotFileEntry(fileEntry) {
        fileEntry.createWriter(WriteText, fail);
    }	

	
function gotFile(file){
      readDataUrl(file);
        readAsText(file);
    }


    function readDataUrl(file) {
        var reader = new FileReader();
        reader.onloadend = function(evt) {
            console.log("Read as data URL");
            console.log(evt.target.result);
        };
        reader.readAsDataURL(file);
    }
	
	function readAsText(file) {
        var reader = new FileReader();
        reader.onloadend = function(evt) {
            console.log("Read as text");
            console.log(evt.target.result);
	 //   alert(evt.target.result);
	    document.getElementById('rest1').value=evt.target.result;	
	    changedate('return');
        };
        reader.readAsText(file);
  }	
	
 function WriteText(writer) {
      writer.onwriteend = function(evt){ // Fired when end write.
        console.log("End write text in file");

    };
writer.write(ajaxResponse);
}
	
    function fail(error) {
        alert('Failed to load events...');
    }
	
	
	
function onConfirmExit(button) {
if(button==2){ //If User select a No, then return back;
       	return; }
else{
   if (navigator.app) {
     navigator.app.exitApp(); }
   else if (navigator.device) {
     navigator.device.exitApp(); } }	}
	   
	
	
	
/* Preload images script */
var ajaxResponse;
var arr_store;
function ajaxFunction()
{
	window.plugins.spinnerDialog.hide();
	if(connSel=='Y')
	{	
	var xhr = new XMLHttpRequest();
	xhr.open('GET', 'http://www.writeacademy.in/MMF/test.php', true);
	xhr.onload = function(){
    	//console.log(xhr);
		//alert(xhr.responseText);
	//document.getElementById("ajaxDiv").innerHTML = xhr.responseText;
	document.getElementById('rest1').value=xhr.responseText;
	ajaxResponse=xhr.responseText;
	window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, gotFS, fail);
	procVal(ajaxResponse);
	};
	xhr.send();
	}
	else
	{
	//	alert('no conn');
	//	alert(document.getElementById('rest1').value);
	procVal(document.getElementById('rest1').value);
	}	
}
	function alertDismissed1()
	{
	navigator.device.exitApp();
		//navigator.app.exitApp();
	}
	
		
var latR;
var events = new Array();
var venue_arr = new Array();
function procVal(pVar)
{
//multiArr=[];
	//alert('Ajax Resp'+pVar);
	locArr = pVar;
	locArr = locArr.substring(0, locArr.length - 1);
	locArr=locArr.split('#');
	//alert('locarr'+locArr);
	events=[];
	venue_arr=[];
	for (var i = 0, len = locArr.length; i < len; i++) {
		delimiter = ',';
		start = 6;
		var result = locArr[i].split(delimiter, start+1).join(delimiter);
		latR=result.split(',');
		//multiArr.push([latR[0],latR[1],latR[2],latR[3],latR[4],latR[5]]);
		pnam=String(latR[0]);
		venue=String(latR[1]);
		venue=venue.replace(/\s/g, '_');
		art=String(latR[2]);
		Pdeta=String(latR[3]);
		pTim=String(latR[5]);
		pLatLong=String(latR[6]);
		var dt = new Date(latR[4]);
		var eDat= dt.getDate();
		eMon=dt.getMonth()+1;
		eYr=dt.getFullYear();
		//multiArr.push([latR[2],latR[0],latR[1],dist]);
		events.push(["",String(eMon),String(eDat),String(eYr),pTim,venue,pnam,Pdeta,art,pLatLong]);
		venue_arr.push([venue]);
		//write ajax response to text file
		
		}
	
	//testing();
	uniq = remove_duplicates_safe(venue_arr);
//	uniq = uniq.map(function(e) {  var result = {};    result['text'] =e[0];  result['value'] =e[0];   return result;});
 //alert(events);
}
	

	
function remove_duplicates_safe(arr) {
    var seen = {};
    var ret_arr = [];
    for (var i = 0; i < arr.length; i++) {
        if (!(arr[i] in seen)) {
            ret_arr.push(arr[i]);
            seen[arr[i]] = true;
        }
    }
    return ret_arr;

}	
var flg=false;	
var lat2,long2;
// Show the picker
	

	
	function venueFilter()
	{
		var j;
		checkConnection();
		getLoc();
		//alert(uniq);
		//lst_mnu.innerHTML='';
		document.getElementById("lst_mnu").style.display="block";
		document.getElementById("lst_mnu").style.visibility="true";
		document.getElementById("calendar").style.display="none";
		document.getElementById("calendar").style.visibility="false";
		document.getElementById("det").style.display="none";
		document.getElementById("det").style.visibility="false";
        if(uniq.length % 2==0)
{
alert('no add');
}
else
{
uniq.push(["d"]);
alert('add');
}
 var im_htm="<table border='0' class='ven' cellpadding='1' cellspacing='1'>";
	//for (var i = 0, len = multiArr.length-1; i < len; i++) {
	for (var i = 0, len = uniq.length; i < len; i++) {
	
	j=i+1;
		
		im_file=uniq[i]+".jpg";
		im1_file=uniq[j]+".jpg";	
	
		

if(uniq[j]=='d')
{
	//	alert('in');
im_htm+="<font size=2><tr height='100px' valign='top'><td width='50%' bordercolor='black'> <table border='0' bordercolor='black'  bgcolor='#1cbe99' class='ven1' cellspacing='0' cellpadding='0'><tr height='120px'><td colspan='2'><button onclick='ven_det(this.value);' class='btn2' value="+uniq[i] +"><img src="+im_file+" width='100px' height='50px'></button></td></tr><tr valign='center'><td><button onclick='ven_det(this.value);' class='btn2' value= "+uniq[i]+">Events</button></td><td><button onclick='ven_det(this.value);' class='btn2' value="+uniq[i] +">Direction</button></td></tr></table></td></tr>";
 }
		else
		{
		//alert('out');
im_htm+="<font size=2><tr height='100px' valign='top'><td width='50%' bordercolor='black'> <table border='0' bgcolor='#1cbe99' bordercolor='black' class='ven1' cellspacing='0' cellpadding='0'><tr height='120px'><td colspan='2'><button onclick='ven_det(this.value);' class='btn2' value="+uniq[i]+"><img src="+im_file+" width='100px' height='50px'></button></td></tr><tr valign='center'><td><button onclick='ven_det(this.value);' class='btn2' value="+uniq[i] +">Events</button></td><td><button onclick='ven_det(this.value);' class='btn2' value="+uniq[i] +">Direction</button></td></tr></table></td>";	
	
im_htm+="<font size=2><td width='50%' bordercolor='black'> <table border='0' bordercolor='black' class='ven1' bgcolor='#1cbe99' cellspacing='0' cellpadding='0'><tr height='120px'><td colspan='2'><button onclick='ven_det(this.value);' class='btn2' value="+uniq[j]+"><img src="+im1_file+" width='100px' height='50px'></button></td></tr><tr valign='center'><td><button onclick='ven_det(this.value);' class='btn2' value="+uniq[j] +">Events</button></td><td><button onclick='ven_det(this.value);' class='btn2' value="+uniq[j] +">Direction</button></td></tr></table></td></tr>";
}
	 i=j;
		
	}
	
document.getElementById('lst_mnu').innerHTML=im_htm+"</font></table>" ;
	
	}
function calClick()
	{
		document.getElementById("lst_mnu").style.display="none";
		document.getElementById("lst_mnu").style.visibility="false"
		document.getElementById("calendar").style.display="block";
		document.getElementById("calendar").style.visibility="true";
		document.getElementById("det").style.display="block";
		document.getElementById("det").style.visibility="true";
		document.getElementById("route_canvas").style.display="none";
		document.getElementById("route_canvas").style.visibility="false"
		document.getElementById("panel").style.display="none";
		document.getElementById("panel").style.visibility="false";
		checkConnection();
	}

	function getDrive()
	{
	
	//alert('in');
	document.getElementById("route_canvas").style.display="block";
	document.getElementById("route_canvas").style.visibility="true";
	document.getElementById("panel").style.display="block";
	document.getElementById("panel").style.visibility="true";
	document.getElementById('panel').innerHTML = "";
	var directionsService = new google.maps.DirectionsService();
        var directionsDisplay = new google.maps.DirectionsRenderer();

         var map = new google.maps.Map(document.getElementById('route_canvas'), {
           zoom:7,
           mapTypeId: google.maps.MapTypeId.ROADMAP
         });
        
         directionsDisplay.setMap(map);
         directionsDisplay.setPanel(document.getElementById('panel'));
	//new google.maps.LatLng(position.coords.latitude,    position.coords.longitude), 13)
      	origin  = new google.maps.LatLng(x,y);
        destination = new google.maps.LatLng(lat2,long2);
         var request = {
		 
           origin: origin, 
           destination: destination,
           travelMode: google.maps.DirectionsTravelMode.DRIVING
         };
    
         directionsService.route(request, function(response, status) {
           if (status == google.maps.DirectionsStatus.OK) {
             directionsDisplay.setDirections(response);
           }
         });
	}

function ven_det(v)
{
	
	k=0;
	document.getElementById("xPort").style.display="block";
	document.getElementById("xPort").style.visibility="true";
	document.getElementById("lst_mnu").style.display="none";
	document.getElementById("lst_mnu").style.visibility="false";
	var evt_lst="<table border='4' id='xportEve' class='ven1' cellpadding='1' cellspacing='1'>";
	//events.push(["",String(eMon),String(eDat),String(eYr),pTim,venue,pnam,Pdeta,art,pLatLong]);	
	for (var i = 0, len = events.length; i < len; i++)
 {
	if(events[i][5]==v)
	{
		alert('in');
		if(k==0)
		{
			alert('in2');
			evt_lst+="<tr><td colspan=3>"+v+"</td></tr><tr><td colspan=3> Programme</td></tr>";
		}
		k++;
	   evt_lst+="<font size=2><tr valign='top'><td width='20%' bordercolor='black'> "+events[i][2]+"."+events[i][1]+"."+events[i][3]+"</td><td>"+events[i][4]+"</td><td>"+events[i][6]+"&nbsp;&nbsp;&nbsp;<b>"+events[i][8]+"</b>&nbsp;&nbsp;"+events[i][7]+"</td></tr>";
		
	}
	 
 document.getElementById('xPort').innerHTML=evt_lst+"</table> <a id='downLoad' href='#'>Download</a>" ;
	

 }
//alert('venue '+v);
}



</script>
	<style type="text/css">
		body, html {
    width: 100%;
    height: 100vh;
    margin: 0;
    padding: 0;
    
}
		.ven
		{
		 width: 100vw;
		  text-align:center; 	
			border-style: solid;
    border-color: black;
		}
		.ven1
		{
		 width: 100vw;
			 text-align:center; 
			border-style: solid;
    border-color: black;
		}
.hideDontTakeUpSpace
        {
            display:none;
        }

.btn1 {  background-color: transparent; border:none; padding: 0; font-weight: bold; color: white;}


	</style>
	
</head>

<body style="background-color: transparent;" onload='init();'> 
	
<div id='wrapper'>
	<table width='100%'>
		<tr height='50%'><td width='50%'><button onclick='ven_det(this.value);' class='btn2' value='health' >Health</button></td><td width='50%'><button onclick='ven_det(this.value);' class='btn2' value='Beauty'>Beauty</button></td></tr>
<tr height='50%'><td width='50%'><button onclick='ven_det(this.value);' class='btn2' value='Cooking'>Cooking</button></td><td width='50%'><button onclick='ven_det(this.value);' class='btn2' value='General'>General</button></td></tr>
	</table>
		
	</div>
<textarea id="rest1" class="hideDontTakeUpSpace" rows=1 cols=50></textarea>
	
</body>
</html>
